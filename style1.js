let products = {
    data: [
        {
            productName: "SDMN Varsity Jacket",
            category: "Jacket",
            price: "6800",
            size: "M",
            color: "Black",
            gender: "Men",
            brand: "high",
            image: "https://cdn.shopify.com/s/files/1/1078/8124/products/VarsityJacket1_900x.png?v=1657557874",
            url: "item_info/item_info1.html",
            tag1: "hoodie",
            tag2: "logang"
        },

        {
            productName: "SDMN Varsity Forest",
            category: "Hoodie",
            price: "6400",
            size: "M",
            color: "Green",
            gender: "Men",
            brand: "high",
            image: "https://cdn.shopify.com/s/files/1/1078/8124/products/ForestGreenHoodie1_900x.png?v=1666444501",
            url: "item_info/item_info2.html",
            tag1: "coat",
            tag2: "pullover"
        },
        {
            productName: "SDMN Varsity Stone",
            category: "Hoodie",
            price: "6400",
            size: "L",
            color: "White",
            gender: "Men",
            brand: "high",
            image: "https://cdn.shopify.com/s/files/1/1078/8124/products/StoneHoodie1_900x.png?v=1666444860",
            url: "item_info/item_info3.html",
            tag1: "coat",
            tag2: "pullover"
        },
        {
            productName: "SDMN Varsity Off",
            category: "Hoodie",
            price: "6400",
            size: "M",
            color: "White",
            gender: "Men",
            brand: "high",
            image: "https://cdn.shopify.com/s/files/1/1078/8124/products/OffWhiteRedHood1_900x.png?v=1657554270",
            url: "item_info/item_info4.html",
            tag1: "coat",
            tag2: "pullover"
        },
        {
            productName: "SDMN Varsity Sweatshirt",
            category: "Sweatshirt",
            price: "4800",
            size: "M",
            color: "Black",
            gender: "Men",
            brand: "medium",
            image: "https://cdn.shopify.com/s/files/1/1078/8124/products/BlackOrangeT-Shirt_900x.png?v=1657555813",
            url: "item_info/item_info6.html",
            tag1: "top",
            tag2: "tee"
        },
        {
            productName: "SDMN Varsity Fullshirt",
            category: "Sweatshirt",
            price: "4800",
            size: "M",
            color: "Black",
            gender: "Men",
            brand: "medium",
            image: "https://cdn.shopify.com/s/files/1/1078/8124/products/BlackOrangeSweater1_900x.png?v=1657554966",
            url: "item_info/item_info5.html",
            tag1: "jumper",
            tag2: "fullarm"
        },
        {
            productName: "SDMN Spongebob shirt",
            category: "T-shirt",
            price: "3000",
            size: "M",
            color: "Black",
            gender: "Men",
            brand: "low",
            image: "https://cdn.shopify.com/s/files/1/1078/8124/products/BubbleT-ShirtBlack1_900x.png?v=1666266539",
            url: "item_info/item_info7.html",
            tag1: "top",
            tag2: "tee"
        },
        {
            productName: "XIX Nitro Puffer",
            category: "Jacket",
            price: "7400",
            size: "M",
            color: "Black",
            gender: "Men",
            brand: "high",
            image: "https://cdn.shopify.com/s/files/1/1078/8124/products/NitroGilet1_900x.png?v=1659435753",
            url: "item_info/item_info8.html",
            tag1: "coat",
            tag2: "jacket"
        },
        {
            productName: "XIX Nitro Hoodie",
            category: "Hoodie",
            price: "4800",
            size: "M",
            color: "Black",
            gender: "Men",
            brand: "medium",
            image: "https://cdn.shopify.com/s/files/1/1078/8124/products/NitroBlackHoodie1_900x.png?v=1664216527",
            url: "item_info/item_info9.html",
            tag1: "pullover",
            tag2: "coat"
        },
        {
            productName: "XIX Nitro Orange Hood",
            category: "Hoodie",
            price: "4800",
            size: "M",
            color: "Orange",
            gender: "Men",
            brand: "medium",
            image: "https://cdn.shopify.com/s/files/1/1078/8124/products/NitroOrangeHoodie1_900x.png?v=1664216573",
            url: "item_info/item_info10.html",
            tag1: "pullover",
            tag2: "coat"
        },
        {
            productName: "XIX Nitro Thunder",
            category: "T-shirt",
            price: "3200",
            size: "M",
            color: "Black",
            gender: "Men",
            brand: "low",
            image: "https://cdn.shopify.com/s/files/1/1078/8124/products/ThunderT-Shirt1_900x.png?v=1659436991",
            url: "item_info/item_info11.html",
            tag1: "polo",
            tag2: "tee"
        },
        {
            productName: "SDMN Varsity Melange",
            category: "Hoodie",
            price: "6400",
            size: "M",
            color: "Grey",
            gender: "Men",
            brand: "high",
            image: "https://cdn.shopify.com/s/files/1/1078/8124/products/GreyGreenHood1_900x.png?v=1657553184",
            url: "item_info/item_info12.html",
            tag1: "pullover",
            tag2: "coat"
        },
        {
            productName: "SDMN Spongebob Hoodie",
            category: "Hoodie",
            price: "6400",
            size: "M",
            color: "Black",
            gender: "Men",
            brand: "high",
            image: "https://cdn.shopify.com/s/files/1/1078/8124/products/BlackHoodie1_900x.png?v=1664364068",
            url: "item_info/item_info13.html",
            tag1: "pullover",
            tag2: "coat"
        },
        {
            productName: "SDMN Blowing Shirt",
            category: "T-shirt",
            price: "3000",
            size: "M",
            color: "White",
            gender: "Men",
            brand: "low",
            image: "https://cdn.shopify.com/s/files/1/1078/8124/products/BubbleT-ShirtWhite1_900x.png?v=1666369710",
            url: "item_info/item_info14.html",
            tag1: "tee",
            tag2: "polo"
        },
        {
            productName: "SDMN Carmine Red Shirt",
            category: "T-shirt",
            price: "3200",
            size: "M",
            color: "Red",
            gender: "Men",
            brand: "low",
            image: "https://cdn.shopify.com/s/files/1/1078/8124/products/RedT-Shirt1_900x.png?v=1666445092",
            url: "item_info/item_info15.html",
            tag1: "polo",
            tag2: "tee"
        },
        {
            productName: "SDMN Pastel Hoodie",
            category: "Hoodie",
            price: "6400",
            size: "M",
            color: "Red",
            gender: "Women",
            brand: "high",
            image: "https://cdn.shopify.com/s/files/1/1078/8124/products/ColourBlockPastelHoodie1_900x.png?v=1637686043",
            url: "item_info/item_info16.html",
            tag1: "pullover",
            tag2: "coat"
        },
        {
            productName: "SDMN Pink Hoodie",
            category: "Hoodie",
            price: "3900",
            size: "M",
            color: "Pink",
            gender: "Women",
            brand: "low",
            image: "https://cdn.shopify.com/s/files/1/1078/8124/products/PastelPinkPartitionHoodie1_900x.png?v=1644858551",
            url: "item_info/item_info17.html",
            tag1: "pullover",
            tag2: "coat"
        },
        {
            productName: "SDMN Partition Hoodie",
            category: "Hoodie",
            price: "3900",
            size: "M",
            color: "Green",
            gender: "Men",
            brand: "low",
            image: "https://cdn.shopify.com/s/files/1/1078/8124/products/PastelGreenPartitionHoodie1_900x.png?v=1638879571",
            url: "item_info/item_info18.html",
            tag1: "pullover",
            tag2: "coat"
        },
        {
            productName: "SDMN Toby Hoodie",
            category: "Hoodie",
            price: "5100",
            size: "M",
            color: "Black",
            gender: "Men",
            brand: "medium",
            image: "https://cdn.shopify.com/s/files/1/1078/8124/products/BlackOrangeHood1_900x.png?v=1657552446",
            url: "item_info/item_info19.html",
            tag1: "pullover",
            tag2: "coat"
        },
        {
            productName: "SDMN Soda Sweatshirt",
            category: "Hoodie",
            price: "4800",
            size: "M",
            color: "Orange",
            gender: "Men",
            brand: "medium",
            image: "https://cdn.shopify.com/s/files/1/1078/8124/products/OrangeSodaSweater1_900x.png?v=1657555754",
            url: "item_info/item_info20.html",
            tag1: "tee",
            tag2: "jumper"
        },
        {
            productName: "SDMN Harry Hoodie",
            category: "Hoodie",
            price: "6400",
            size: "M",
            color: "White",
            gender: "Men",
            brand: "high",
            image: "https://cdn.shopify.com/s/files/1/1078/8124/products/OffWhiteHoodie1_900x.png?v=1664364080",
            url: "item_info/item_info21.html",
            tag1: "pullover",
            tag2: "coat"
        },
    ],
};
let productCount = 0;
for (let i of products.data) {

    //Create Card
    let card = document.createElement("div");
    //Card should have category and should stay hidden initially
    card.classList.add("card", i.category, "hide");
    //image div
    let imgContainer = document.createElement("div");
    imgContainer.classList.add("image-container");
    //img tag
    let image = document.createElement("img");
    image.setAttribute("src", i.image);
    card.onclick = function () {
        window.location.href = i.url;
    };

    imgContainer.appendChild(image);
    card.appendChild(imgContainer);
    //container
    let container = document.createElement("div");
    container.classList.add("container");
    //product name
    let name = document.createElement("h5");
    name.classList.add("product-name");
    name.innerText = i.productName.toUpperCase();
    container.appendChild(name);
    //price
    let price = document.createElement("h6");
    price.innerText = "Rs" + i.price;
    container.appendChild(price);



    card.appendChild(container);
    card.setAttribute("data-gender", i.gender);
    card.setAttribute("data-color", i.color);
    card.setAttribute("data-size", i.size);
    card.setAttribute("data-brand", i.brand);
    card.setAttribute("data-tag1", i.tag1);
    card.setAttribute("data-tag2", i.tag2);
    card.style.padding = "1em";
    document.getElementById("products").appendChild(card);

}
// Get the search bar input element
let searchInput = document.getElementById("search-input");
let searchButton1 = document.getElementById("search");
let count = 0;
// Listen for changes in the search bar input value
searchButton1.addEventListener("click", function () {
    // Get the search term from the input value
    let searchTerm = searchInput.value.trim().toLowerCase();

    // Count the number of products that match the search term
    count = 0;
    for (let i of products.data) {
        if (i.productName.toLowerCase().includes(searchTerm)) {
            count++;
        }
    }

    // Update the count display
    console.log(count + " products found");
});


function recommend(tag) {
    let recommendDiv = document.getElementById("recommend");
    recommendDiv.innerHTML = "";

    let numRecommended = 0;

    for (let i of products.data) {
        if (i.tag1 === tag || i.tag2 === tag) {
            let card = document.createElement("div");
            card.classList.add("card", i.category);
            let imgContainer = document.createElement("div");
            imgContainer.classList.add("image-container");
            let image = document.createElement("img");
            image.setAttribute("src", i.image);
            card.onclick = function () {
                window.location.href = i.url;
            };
            imgContainer.appendChild(image);
            card.appendChild(imgContainer);
            let container = document.createElement("div");
            container.classList.add("container");
            let name = document.createElement("h5");
            name.classList.add("product-name");
            name.innerText = i.productName.toUpperCase();
            container.appendChild(name);
            let price = document.createElement("h6");
            price.innerText = "$" + i.price;
            container.appendChild(price);
            card.appendChild(container);
            recommendDiv.appendChild(card);
            card.style.padding = "1em";

            numRecommended++;
        }
    }
    if (numRecommended >= 1) {
        let heading = document.getElementById("heading");
        heading.innerText = "Recommended Products";
        heading.classList.add("no-products");
        recommendDiv.classList.add("no-products");
    }
    if (count === 0) {
        recommendDiv.classList.add("no-products");
        heading.classList.add("no-products");
        heading.innerText = "";
    }
    else {
        recommendDiv.classList.remove("no-products");
        heading.classList.remove("no-products");
        // heading.innerText = "";
    }
    if (numRecommended === 0 && count === 0) {
        let heading = document.getElementById("heading");
        heading.innerText = "No matching products found. Here are some random products:";
        recommendDiv.classList.add("no-products");
        heading.classList.add("no-products");
        let randomProducts = getRandomProducts(6);
        for (let i of randomProducts) {
            let card = document.createElement("div");
            card.classList.add("card", i.category);
            let imgContainer = document.createElement("div");
            imgContainer.classList.add("image-container");
            let image = document.createElement("img");
            image.setAttribute("src", i.image);
            card.onclick = function () {
                window.location.href = i.url;
            };
            imgContainer.appendChild(image);
            card.appendChild(imgContainer);
            let container = document.createElement("div");
            container.classList.add("container");
            let name = document.createElement("h5");
            name.classList.add("product-name");
            name.innerText = i.productName.toUpperCase();
            container.appendChild(name);
            let price = document.createElement("h6");
            price.innerText = "$" + i.price;
            container.appendChild(price);
            card.appendChild(container);
            recommendDiv.appendChild(card);
            card.style.padding = "1em";
        }
    }

}
document.getElementById("search").addEventListener("click", () => {
    //initializations
    let searchInput = document.getElementById("search-input").value;
    let elements = document.querySelectorAll(".product-name");
    let cards = document.querySelectorAll(".card");
    let resultCount = 0; //to track the number of search results found      

    //loop through all elements
    elements.forEach((element, index) => {
        //check if text includes the search value
        if (element.innerText.includes(searchInput.toUpperCase())) {
            //display matching card
            cards[index].classList.remove("hide");
            resultCount++; //increment result count
        } else {
            cards[index].classList.add("hide");
        }
    });

    //display result not found message
    let resultMessage = document.getElementById("result-message");
    if (resultCount == 0) {
        resultMessage.classList.remove("hide");
    } else {
        resultMessage.classList.add("hide");
    }

});

let checkboxes = document.querySelector('input[type="checkbox"]');
let topwearButton = document.querySelector(".button-value");
checkboxes.addEventListener("click", function () {
    // Get the recommendDiv element
    let recommendDiv = document.getElementById("recommend");
    let heading = document.getElementById("heading");

    // Clear the recommendations div if the Topwear button is clicked
    recommendDiv.innerHTML = "";
    heading.innerHTML = "";

    // Exit the event listener function early to prevent further code execution
    return;
});
topwearButton.addEventListener("click", function () {
    // Get the recommendDiv element
    let recommendDiv = document.getElementById("recommend");
    let heading = document.getElementById("heading");

    // Clear the recommendations div if the Topwear button is clicked
    recommendDiv.innerHTML = "";
    heading.innerHTML = "";

    // Exit the event listener function early to prevent further code execution
    return;
});

function getRandomProducts(count) {
    let randomProducts = [];
    let maxIndex = products.data.length - 1;
    let productsCopy = [...products.data]; // create a copy of the products array

    for (let i = 0; i < count; i++) {
        let randomIndex = Math.floor(Math.random() * (maxIndex + 1));
        randomProducts.push(productsCopy[randomIndex]);
        productsCopy.splice(randomIndex, 1); // remove the selected product from the copy
        maxIndex--;
    }

    return randomProducts;
}


let searchButton = document.getElementById("search");
searchButton.addEventListener("click", function () {
    let searchInput = document.getElementById("search-input").value;
    recommend(searchInput);
});


function filterProduct(value) {
    //Button class code
    let buttons = document.querySelectorAll(".button-value");
    buttons.forEach((button) => {
        //check if value equals innerText
        if (value.toUpperCase() === button.innerText.toUpperCase()) {
            button.classList.add("active");
        } else {
            button.classList.remove("active");
        }
    });


    //select all cards
    let elements = document.querySelectorAll(".card");
    //loop through all cards
    elements.forEach((element) => {
        //display all cards on 'all' button click
        if (value === "all") {
            element.classList.remove("hide");
        } else {
            //Check if element contains category class
            if (element.classList.contains(value)) {
                //display element based on category
                element.classList.remove("hide");
            } else {
                //hide other elements
                element.classList.add("hide");
            }
        }
    });
    // showResultMessage();
}


function filterProducts() {
    // Get all selected values
    const selectedColors = Array.from(document.querySelectorAll('input[name="color"]:checked')).map((checkbox) => checkbox.value);
    const selectedGenders = Array.from(document.querySelectorAll('input[name="gender"]:checked')).map((checkbox) => checkbox.value);
    const selectedBrand = Array.from(document.querySelectorAll('input[name="brand"]:checked')).map((checkbox) => checkbox.value);
    // Select all cards
    const elements = document.querySelectorAll('.card');
    var resultMessage = document.getElementById('result-message1');
    let count = 0;

    // Loop through all cards
    elements.forEach((element) => {
        const productColor = element.getAttribute('data-color');
        const productGender = element.dataset.gender;
        const productdBrand = element.dataset.brand;
        // Check if the card's color and gender match any of the selected values
        const colorMatch = selectedColors.length === 0 || selectedColors.includes(productColor);
        const genderMatch = selectedGenders.length === 0 || selectedGenders.includes(productGender) || (selectedGenders.includes("Men") && selectedGenders.includes("Women") && productGender === "Both");
        const brandMatch = selectedBrand.length === 0 || selectedBrand.includes(productdBrand) || (selectedBrand.includes("Sidemen") && selectedBrand.includes("Logang") && productdBrand === "Both");
        // Display card if it matches the selected values, hide it otherwise
        if (colorMatch && genderMatch && brandMatch) {
            element.classList.remove('hide');
            count++;
        } else {
            element.classList.add('hide');
        }
    });
    let heading = document.getElementById('heading');
    // showResultMessage();
    if (count === 0) {
        resultMessage.innerHTML = 'No matching products found.';
        heading.innerHTML = "";
    } else {
        // resultMessage.innerHTML = `Showing ${count} matching products.`;
        heading.innerHTML = "";
    }
}
// Add event listeners to all checkboxes
document.querySelectorAll('input[name="color"], input[name="gender"],input[name="brand"]').forEach((checkbox) => {
    checkbox.addEventListener('change', filterProducts);
});

if (window.performance) {
    if (performance.navigation.type == 1) {
        // Page is reloaded
        const searchParams = new URLSearchParams(window.location.search);
        searchParams.delete('searchQuery');
        const newUrl = `${window.location.origin}${window.location.pathname}?${searchParams.toString()}`;
        window.location.replace(newUrl);
    }
}



